Понял. Давай просто и по-человечески, без жаргона. Ниже короткая версия, которую легко выучить и проговорить.

# Общая идея

Есть два режима.

1. Поиск фрагмента в изображении. Берем маленький кусок и ищем, где точно такой же кусок лежит в большой картинке.
2. Поиск повторов в одной картинке. Смотрим, на какие сдвиги рисунок похож сам на себя. Это помогает заметить периодичность: плитку, кирпич, сетку.

# Что такое «среднее», «центрирование», «скалярное произведение» и «L2-норма»

* Среднее по фрагменту — это просто средняя яркость всех его пикселей. Сложили все числа, поделили на их количество.
* «Вычесть среднее из фрагмента» — значит из каждого пикселя этого фрагмента вычесть одну и ту же величину, его среднюю яркость. В итоге у фрагмента «средняя яркость» становится около нуля. То же самое делаем с каждым окошком в картинке, куда мы этот фрагмент прикладываем. Зачем это нужно: чтобы сравнение не ломалось, если картинка чуть светлее или темнее. Мы сравниваем не общий уровень яркости, а «рисунок» колебаний.
* «Скалярное произведение» в нашем контексте — это очень просто: умножаем попарно пиксели фрагмента и окошка и все получившиеся произведения складываем. Если узор совпал — сумма большая, если нет — маленькая или отрицательная.
* L2-норма — это число, которое показывает «размах» колебаний. Считается так: возводим все значения в квадрат, складываем, берем корень из суммы. Нужна, чтобы результат привезти к удобному диапазону и не зависеть от контраста.

# Как считается взаимная корреляция (поиск фрагмента)

1. Переводим картинки в серый и масштабируем до разумного размера для скорости.
2. Берем фрагмент и двигаем по всей картинке «окно» такого же размера.
3. Для каждого положения:

   * вычитаем из фрагмента его среднюю яркость;
   * вычитаем из текущего окна его среднюю яркость;
   * перемножаем попарно и все суммируем — это «насколько формы похожи»;
   * делим на произведение L2-норм фрагмента и окна — это нормализация. Благодаря ей итог всегда между −1 и 1. 1 — идеально, 0 — никак, отрицательно — похоже на инверсию.
4. Получаем «карту похожести». Самая светлая точка — лучшее совпадение. Там рисуем прямоугольник.

Чтобы это работало быстро, средние и «размахи» по окнам считаются не в циклах, а с помощью «накопленных сумм». Это такая таблица, из которой сумму по любому прямоугольнику можно достать мгновенно. Плюс используется векторная обработка без питоновских циклов.

Еще один штрих: вокруг найденного максимума часто есть кучка почти таких же пиков. Мы берем один главный, а соседние гасим. Это называется подавление немаксимумов, но по сути — «оставь один пик на область».

# Что показывается пользователю

* Исходное изображение.
* Выбранный фрагмент.
* Карта похожести.
* Прямоугольник на исходнике в найденном месте и список альтернативных совпадений выше порога.

# Как считается автокорреляция (повторы в одной картинке)

Идея: сдвигаем картинку на разные векторы и смотрим, насколько она при таком сдвиге похожа сама на себя. Если в рисунке есть период, на соответствующем сдвиге получим высокий балл.

Считать «сдвиг за сдвигом» долго, поэтому используется быстрый прием под названием БПФ. Он позволяет получить все сравнения для всех сдвигов разом. В коде это пара строк, математические детали можно не углублять.

Дальше делаем аккуратную нормировку:

* убираем влияние общей яркости, вычитая среднее;
* учитываем, что у больших сдвигов частей картинки пересекается меньше, чем у малых, поэтому делим на реальное число перекрывающихся пикселей;
* делим на дисперсию, чтобы привести значения к понятной шкале, и фиксируем центр равным 1.

На карте автокорреляции центральная точка всегда 1. Остальные яркие точки — это «правдоподобные сдвиги повтора». Мы берем топ пиков и показываем их как векторы (dx, dy) и их силу. Для наглядности по выбранному пику программа берет исходник и его копию, сдвигает на этот вектор и накладывает их полупрозрачно. Если видно, что детали совпали — сдвиг реальный.

# Что сказать на защите одной минутой

* Взаимная корреляция. Я сравниваю фрагмент со всеми позициями картинки. Чтобы не зависеть от яркости и контраста, из фрагмента и окна вычитаю их средние значения и делю результат на их «размах» колебаний. Получается число от −1 до 1. Максимум — это место фрагмента. Считаю быстро за счет накопленных сумм и векторизации.
* Автокорреляция. Ищу, на какие сдвиги картинка похожа сама на себя. Считаю через БПФ, так быстрее. Нормирую по перекрытию и дисперсии. Пики показывают повторяющиеся сдвиги. Для выбранного пика показываю наложение двух копий — видно совпадение узора.
* В интерфейсе есть пороги, чтобы отсеивать слабые совпадения. Есть подавление близких максимумов, чтобы не было пачки почти одинаковых кандидатов.

# Короткий словарик в двух строках

* Среднее по фрагменту — средняя яркость его пикселей.
* Центрировать — вычесть это среднее из каждого пикселя.
* Скалярное произведение — перемножить попарно и сложить.
* L2-норма — корень из суммы квадратов значений, меряет «размах».
* БПФ — способ посчитать сравнения для всех сдвигов сразу, очень быстро.

Если хочешь, сделаю ультракороткую шпаргалку на одну страницу с формулами и картинками «что где на карте» — удобно взять на защиту.
