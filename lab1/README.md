# Лабораторная работа: Генерация сигналов (Python)

В папке `lab1` реализованы генераторы звуковых сигналов базовых форм и утилита для сохранения в WAV без использования сторонних библиотек.

Поддерживаемые формы:
- синусоида;
- импульс (прямоугольный) с регулируемой скважностью;
- треугольная;
- пилообразная;
- шум (равномерный, «белоподобный»).

## Структура
- `lab1/signals.py` — генераторы сигналов
- `lab1/io.py` — запись моно WAV (16-bit PCM)
- `lab1/main.py` — CLI для генерации и сохранения

## Быстрый старт
Запускать команды для удобства из каталога `lab1`:
```bash
cd /Users/mashkakoser/Documents/ЦОС/lab1
```

Сохранить 2-секундную синусоиду 440 Гц:
```bash
python3 -m main sine -f 440 -t 2 -r 44100 -a 0.8 -o sine_440.wav
```

Сохранить прямоугольный импульс 1 кГц со скважностью 25%:
```bash
python3 -m main pulse -f 1000 -d 25 -t 2 -o pulse_1kHz_25.wav
```

Треугольный сигнал 500 Гц:
```bash
python3 -m main triangle -f 500 -t 2 -o triangle_500.wav
```

Пилообразный сигнал 300 Гц:
```bash
python3 -m main saw -f 300 -t 2 -o saw_300.wav
```

Шум 3 секунды:
```bash
python3 -m main noise -t 3 -o noise.wav
```

### Полифония (сложение сигналов)
Одинаковый тип (`--freqs`):
```bash
python3 -m main sine --freqs 440,550,660 -t 3 -r 44100 -a 0.6 -o chord.wav
```

Разные типы (`--poly`):
```bash
# 3 синусоиды + 2 пилообразных + 1 шум
python3 -m main --poly "sine:440,550,660;saw:330,495;noise" -t 3 -r 44100 -a 0.5 -o mix.wav
```

Отключить нормализацию при смешивании (возможен клиппинг):
```bash
python3 -m main sine --freqs 440,550,660 -t 3 --no-normalize -o chord_raw.wav
```

## Модуляция
### AM (амплитудная)
Моно (синус 440 Гц), модулятор синус 5 Гц, глубина 0.8:
```bash
python3 -m main sine -f 440 -t 3 -r 44100 -a 0.8 --am sine:5:0.8 -o am_sine.wav
```

Поли (после сложения 3 синусов и 2 пил, применить AM):
```bash
python3 -m main --poly "sine:440,550,660;saw:330,495" -t 3 -r 44100 -a 0.6 --am sine:5:0.8 -o mix_am.wav
```

### FM (частотная)
Моно (синус 440 Гц), модулятор треугольник 3 Гц, девиация 50 Гц:
```bash
python3 -m main sine -f 440 -t 3 -r 44100 -a 0.8 --fm triangle:3:50 -o fm_sine.wav
```

FM для пилы (моно):
```bash
python3 -m main saw -f 330 -t 3 --fm sine:2:80 -o fm_saw.wav
```

FM на поли в один шаг не применяется ко всем голосам одновременно (несущая должна быть одного типа и частоты). Варианты:
- применить FM к моно-сигналу и потом смешать внешне (sox/ffmpeg), или
- сгенерировать несколько FM-несущих по отдельности и смешать через `--poly` (потребуется несколько запусков).

### AM и FM одновременно (сначала FM, потом AM)
Моно: FM (triangle:3:50) → AM (sine:5:0.8):
```bash
python3 -m main sine -f 440 -t 3 --fm triangle:3:50 --am sine:5:0.8 -o fm_am_sine.wav
```

Поли: сложение 3 синусов и 2 пил → AM:
```bash
python3 -m main --poly "sine:440,550,660;saw:330,495" -t 3 --am sine:5:0.8 -o poly_am.wav
```

Разные модуляторы:
```bash
python3 -m main sine -f 440 -t 3 --am pulse:2:1.0 -d 25 -o am_pulse.wav
python3 -m main saw  -f 330 -t 3 --fm sine:2:80               -o fm_saw.wav
```

### Сирены
Сирены экстренных служб с помощью частотной модуляции:

**Скорая помощь** (медленный "вой" 800-1200 Гц):
```bash
python3 -m main sine -f 900 -t 4 --fm triangle:1.5:300 --echo 0.05:0.4:3 -o ambulance_siren.wav
```

**Полиция** (быстрый "вой" 600-1000 Гц):
```bash
python3 -m main sine -f 700 -t 3 --fm sine:2:250 --echo 0.08:0.3:2 -o police_siren.wav
```

**Пожарная машина** (громкий "рёв" 500-1100 Гц):
```bash
python3 -m main sine -f 600 -t 2.5 --fm triangle:3:400 --echo 0.03:0.5:4 -o fire_truck_siren.wav
```

**Hi-Lo сирена** (двухтональная, 800-1000 Гц):
```bash
python3 -m main sine --poly "sine:800,1000" -t 3 --fm triangle:1:100 --echo 0.1:0.3:2 -o hi_lo_ambulance.wav
```

**Настраиваемые параметры сирен:**
- Базовая частота: 600-900 Гц (определяет тональность)
- Частота модуляции: 1-3 Гц (скорость "вой")
- Девиация: 200-400 Гц (диапазон изменения тона)
- Эхо: добавляет реализма и глубины звучания

### Быстрое создание сирен
Для удобства создан скрипт `create_siren.sh`:

```bash
# Показать доступные типы сирен
./create_siren.sh

# Создать сирену скорой помощи длительностью 4 секунды
./create_siren.sh ambulance 4

# Создать полицейскую сирену (длительность по умолчанию 3 секунды)
./create_siren.sh police

# Создать короткую сирену пожарной машины
./create_siren.sh fire 1.5
```

## Эффекты
### Эхо
Добавляет эффект эха к любому сигналу. Поддерживаются несколько повторяющихся эхо с экспоненциальным затуханием.

Формат: `--echo delay:decay[:echoes]`

- `delay` — задержка между эхом в секундах (например, 0.3)
- `decay` — коэффициент затухания каждого следующего эха (0.0-1.0, например, 0.5)
- `echoes` — количество эхо (по умолчанию 3)

Примеры:
```bash
# Простое эхо: задержка 0.3с, затухание 0.4, 2 эха
python3 -m main sine -f 440 -t 2 --echo 0.3:0.4:2 -o sine_echo.wav

# Сильное эхо: задержка 0.5с, слабое затухание 0.3, 4 эха
python3 -m main saw -f 300 -t 1.5 --echo 0.5:0.3:4 -o saw_echo.wav

# Эхо на аккорде
python3 -m main --poly "sine:440,550,660" -t 3 --echo 0.2:0.6:3 -o chord_echo.wav

# Эхо после модуляции
python3 -m main sine -f 440 -t 4 --am triangle:2:0.8 --echo 0.4:0.5:2 -o am_echo.wav
```

## Параметры CLI
- `type` — тип сигнала: `sine`, `pulse`, `triangle`, `saw`, `noise`
- `-f/--freq` — частота, Гц (для `noise` игнорируется)
- `-d/--duty` — скважность для `pulse`: 0..1 или % (например, 25 или 0.25)
- `-t/--duration` — длительность, секунды
- `-r/--rate` — частота дискретизации, Гц (по умолчанию 44100)
- `-a/--amp` — амплитуда 0..1 (по умолчанию 0.8)
- `-o/--outfile` — путь к выходному WAV (если не указан — имя формируется автоматически)

### Модуляция и эффекты
- `--am type:freq[:depth]` — амплитудная модуляция (глубина по умолчанию 1.0)
- `--fm type:freq:deviation` — частотная модуляция (девиация в Гц)
- `--echo delay:decay[:echoes]` — эффект эха (задержка в сек, затухание 0-1, кол-во эхо)

## Использование как библиотеки
```python
from lab1 import generate_sine, generate_pulse, write_wav_mono

samples = generate_sine(440, duration_s=1.0, sample_rate_hz=44100, amplitude=0.8)
write_wav_mono('sine.wav', samples, 44100)
```

## Примечания
- Амплитуда ограничена диапазоном [-1, 1] и сохраняется как 16-bit PCM.
- Скважность `-d/--duty` > 1 воспринимается как проценты, иначе как доля периода.
- Сторонние библиотеки не используются; применяются только стандартные модули Python.

